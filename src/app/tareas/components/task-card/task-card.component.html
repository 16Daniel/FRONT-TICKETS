<div class="task-card" cdkDrag [cdkDragData]="tarea" (click)="onClick()">

  <div class="priority-badge">
    <span *ngIf="tarea.idEisenhower == '1'" pTooltip="PELIGRO! Hazlo ya">C1:ğŸ”¥</span>
    <span *ngIf="tarea.idEisenhower == '2'" pTooltip="VALOR! PlanifÃ­calo ya">C2:ğŸ’</span>
    <span *ngIf="tarea.idEisenhower == '3'" pTooltip="RUIDO! Si puedes, delÃ©galo">C3:ğŸ“¢</span>
    <span *ngIf="tarea.idEisenhower == '4'" pTooltip="TRANQUILO.. Puede esperar">C4:â³</span>
  </div>

  <!-- TÃTULO -->
  <!-- <div class="d-flex align-items-center mb-1">
    <div class="titulo">
      <i [class]="tarea.visibleSoloParaMi ? 'bx bx-lock-open-alt text-success' : 'bx bx-lock-alt text-danger'"
        [pTooltip]="tarea.visibleSoloParaMi ? 'Tarea pÃºblico' : 'Tarea privada'" class="me-1 visibility-icon">
      </i>
      {{ tarea.titulo }}
    </div>
  </div> -->

  <div class="d-flex align-items-center mb-1">
    <div class="titulo">
      <i class="fa-solid me-2 visibility-icon"
        [class.fa-lock-open]="tarea.visibleSoloParaMi" [class.text-success]="tarea.visibleSoloParaMi"
        [class.fa-lock]="!tarea.visibleSoloParaMi" [class.text-danger]="!tarea.visibleSoloParaMi"
        [pTooltip]="tarea.visibleSoloParaMi ? 'Tarea pÃºblica' : 'Tarea privada'" tooltipPosition="top">
      </i>

      {{ tarea.titulo }}
    </div>
  </div>

  <!-- SUCURSAL -->
  <div class="sucursal-info" *ngIf="nombreSucursal">
    <!-- <span class="sucursal-badge" [class.global]="esOtraSucursal">
      <i *ngIf="esOtraSucursal" class="pi pi-globe"></i>
      {{ nombreSucursal }}
    </span> -->
    <span class="sucursal-badge">
      {{ nombreSucursal }}
    </span>
  </div>

  <!-- ETIQUETA -->
  <div class="fila-etiqueta" *ngIf="tarea.idEtiqueta">
    <div class="etiqueta-contenedor">
      <span class="etiqueta-icono" [style.background]="getEtiquetaColor(tarea.idEtiqueta)">
      </span>
      <span class="etiqueta-texto">
        {{ getEtiquetaNombre(tarea.idEtiqueta) }}
      </span>
    </div>
  </div>

  <!-- CATEGORÃA -->
  <div>{{ tarea.categoria }}</div>

  <!-- META -->
  <div class="meta">
    <span class="fecha">
      {{ tarea.fecha | date:'dd/MM/yyyy' }}

      <ng-container *ngIf="tarea.deathline">
        Â· â° {{ tarea.deathline | date:'dd/MM/yyyy' }}
      </ng-container>
    </span>

    <span class="estatus estatus-{{ tarea.idEstatus }}"></span>
  </div>

  <div class="subtareas-info" *ngIf="tarea.subtareas?.length"
    pTooltip="{{ getSubtareasCompletadas(tarea) }} / {{ tarea.subtareas?.length }} subtareas completadas"
    tooltipPosition="top">

    <i class="bx bx-check-square me-1"></i>
    <span class="fw-semibold">
      {{ getSubtareasCompletadas(tarea) }}/{{ tarea.subtareas?.length }}
    </span>

  </div>



  <div class="avatars-container" *ngIf="tarea.idsResponsables?.length">
    <ngx-avatars *ngFor="let r of getResponsablesDeTarea(tarea)" [name]="r.nombre" [size]="30" class="avatar-item"
      pTooltip="{{r.nombre }}" [bgColor]="r.color">
    </ngx-avatars>
  </div>



  <!-- PROGRESO -->
  <div *ngIf="tarea.porcentaje !== undefined" class="mt-3">
    <div class="progress" style="height: 20px;">
      <div class="progress-bar" [ngClass]="getProgressColor(tarea.porcentaje)" [style.width.%]="tarea.porcentaje">
        {{ tarea.porcentaje }}%
      </div>
    </div>
  </div>

  <!-- ARCHIVAR -->
  <button *ngIf="tarea.idEstatus === '4'" class="btn btn-sm btn-outline-secondary mt-2"
    (click)="archivarTarea(tarea); $event.stopPropagation()">
    <i class="bx bx-archive"></i> Archivar
  </button>

  <!-- DEADLINE -->
  <div class="deadline-indicator" *ngIf="tarea.deathline && tarea.idEstatus !== '4'" (click)="$event.stopPropagation()">

    <div class="mini-pie" [style.--progress]="getPorcentajeUsado(tarea)">
    </div>

    <div class="mini-text">
      Restan {{ getDiasRestantes(tarea) }} dÃ­as
    </div>

  </div>

</div>
