<div class="task-card" cdkDrag [cdkDragData]="tarea" (click)="onClick()">

  <!-- TÍTULO -->
  <div class="d-flex justify-content-between align-items-center">
    <div class="titulo">{{ tarea.titulo }}</div>
  </div>

  <!-- SUCURSAL -->
  <div class="sucursal-info" *ngIf="nombreSucursal">
    <span class="sucursal-badge" [class.global]="esOtraSucursal">
      <i *ngIf="esOtraSucursal" class="pi pi-globe"></i>
      {{ nombreSucursal }}
    </span>
  </div>

  <!-- ETIQUETA -->
  <div class="fila-etiqueta" *ngIf="tarea.idEtiqueta">
    <div class="etiqueta-contenedor">
      <span class="etiqueta-icono" [style.background]="getEtiquetaColor(tarea.idEtiqueta)">
      </span>
      <span class="etiqueta-texto">
        {{ getEtiquetaNombre(tarea.idEtiqueta) }}
      </span>
    </div>
  </div>

  <!-- CATEGORÍA -->
  <div>{{ tarea.categoria }}</div>

  <!-- META -->
  <div class="meta">
    <span class="fecha">
      {{ tarea.fecha | date:'dd/MM/yyyy' }}

      <ng-container *ngIf="tarea.deathline">
        · ⏰ {{ tarea.deathline | date:'dd/MM/yyyy' }}
      </ng-container>
    </span>

    <span class="estatus estatus-{{ tarea.idEstatus }}"></span>
  </div>

  <div class="subtareas-info" *ngIf="tarea.subtareas?.length"
    pTooltip="{{ getSubtareasCompletadas(tarea) }} / {{ tarea.subtareas?.length }} subtareas completadas"
    tooltipPosition="top">

    <i class="bx bx-check-square me-1"></i>
    <span class="fw-semibold">
      {{ getSubtareasCompletadas(tarea) }}/{{ tarea.subtareas?.length }}
    </span>

  </div>



  <div class="avatars-container" *ngIf="tarea.idsResponsables?.length">
    <ngx-avatars *ngFor="let r of getResponsablesDeTarea(tarea)" [name]="r.nombre" [size]="30" class="avatar-item"
      pTooltip="{{r.nombre }}" [bgColor]="r.color">
    </ngx-avatars>
  </div>



  <!-- PROGRESO -->
  <div *ngIf="tarea.porcentaje !== undefined" class="mt-3">
    <div class="progress" style="height: 20px;">
      <div class="progress-bar" [ngClass]="getProgressColor(tarea.porcentaje)" [style.width.%]="tarea.porcentaje">
        {{ tarea.porcentaje }}%
      </div>
    </div>
  </div>

  <!-- ARCHIVAR -->
  <button *ngIf="tarea.idEstatus === '4'" class="btn btn-sm btn-outline-secondary mt-2"
    (click)="archivarTarea(tarea); $event.stopPropagation()">
    <i class="bx bx-archive"></i> Archivar
  </button>

  <!-- DEADLINE -->
  <div class="deadline-indicator" *ngIf="tarea.deathline && tarea.idEstatus !== '4'" (click)="$event.stopPropagation()">

    <div class="mini-pie" [style.--progress]="getPorcentajeUsado(tarea)">
    </div>

    <div class="mini-text">
      Restan {{ getDiasRestantes(tarea) }} días
    </div>

  </div>

</div>
