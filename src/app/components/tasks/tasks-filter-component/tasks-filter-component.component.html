<div class="row align-items-center">

  <!-- TOGGLE LOCAL / GLOBAL -->
  <div class="col-12 mb-3">
    <div class="d-flex gap-2">

      <button type="button" class="btn" (click)="onToggleModo(false)" [class.btn-primary]="!mostrarFiltrosGlobales"
        [class.btn-outline-primary]="mostrarFiltrosGlobales">
        Filtros locales
      </button>

      <button type="button" class="btn" (click)="onToggleModo(true)" [class.btn-primary]="mostrarFiltrosGlobales"
        [class.btn-outline-primary]="!mostrarFiltrosGlobales">
        Filtros globales
      </button>

    </div>
  </div>

  <!-- ========================= -->
  <!-- FILTROS LOCALES (ACTUALES) -->
  <!-- ========================= -->
  <div class="row" *ngIf="!mostrarFiltrosGlobales">

    <!-- SUCURSAL -->
    <div class="col-md-4">
      <p class="fw-bold mb-1">SUCURSAL Ó DEPARTAMENTO</p>
      <p-dropdown [options]="sucursales" [(ngModel)]="idSucursalSeleccionada" optionLabel="nombre" optionValue="id"
        [filter]="true" filterBy="nombre" placeholder="SELECCIONA SUCURSAL / DEPARTAMENTO" [style]="{ width: '100%' }"
        (onChange)="onSucursalChange()">
      </p-dropdown>
    </div>

    <!-- ETIQUETAS -->
    <div class="col-md-4">
      <p class="fw-bold mb-1">ETIQUETAS</p>
      <p-dropdown [options]="etiquetas" [(ngModel)]="idEtiquetaSeleccionada" optionLabel="nombre" optionValue="id"
        [filter]="true" placeholder="ETIQUETAS" [showClear]="true" [style]="{ width: '100%' }"
        (onChange)="etiquetaChange.emit(idEtiquetaSeleccionada)">

        <ng-template pTemplate="selectedItem" let-selected>
          <div class="flex align-items-center gap-2" *ngIf="selected">
            <span class="label-dot" [style.background]="selected.color"></span>
            <span>{{ selected.nombre }}</span>
          </div>
        </ng-template>

        <ng-template pTemplate="item" let-item>
          <div class="flex align-items-center gap-2">
            <span class="label-dot" [style.background]="item.color"></span>
            <span>{{ item.nombre }}</span>
          </div>
        </ng-template>
      </p-dropdown>
    </div>

    <!-- RESPONSABLES -->
    <div class="col-md-4">
      <p class="fw-bold mb-1">RESPONSABLES</p>
      <p-dropdown [options]="responsables" [(ngModel)]="idResponsableSeleccionado" optionLabel="nombre" optionValue="id"
        [filter]="true" [showClear]="true" placeholder="RESPONSABLES" class="custom-responsable-dropdown"
        [style]="{ width: '100%' }" (onChange)="onResponsableChange($event.value)">

        <ng-template pTemplate="selectedItem" let-selected>
          <div class="flex align-items-center gap-2" *ngIf="selected">
            <i *ngIf="selected.esGlobal" class="pi pi-globe global-icon"></i>
            <span>{{ selected.nombre }}</span>
          </div>
        </ng-template>

        <ng-template pTemplate="item" let-item>
          <div class="d-flex justify-content-between align-items-center w-100">
            <div class="d-flex flex-column">
              <span class="fw-medium">{{ item.nombre }}</span>
              <small class="text-muted">{{ item.posicion }}</small>
            </div>
            <span *ngIf="item.esGlobal" class="badge-global">GLOBAL</span>
          </div>
        </ng-template>

      </p-dropdown>

    </div>
  </div>

  <!-- ========================= -->
  <!-- FILTROS GLOBALES (NUEVOS) -->
  <!-- ========================= -->
  <div class="row" *ngIf="mostrarFiltrosGlobales">

    <!-- RESPONSABLES GLOBALES -->
    <div class="col-md-6">
      <p class="fw-bold mb-1">RESPONSABLES</p>
      <p-multiSelect [options]="responsables" [(ngModel)]="idsResponsablesGlobalesSeleccionados" optionLabel="nombre"
        optionValue="id" [filter]="true" display="chip" placeholder="RESPONSABLES GLOBALES"
        class="custom-responsable-dropdown" [style]="{ width: '100%' }"
        (onChange)="onResponsablesGlobalesChange($event.value)">

        <ng-template pTemplate="item" let-item>
          <div class="d-flex justify-content-between align-items-center w-100">
            <div class="d-flex flex-column">
              <span class="fw-medium">{{ item.nombre }}</span>
              <small class="text-muted">{{ item.posicion }}</small>
            </div>
            <span *ngIf="item.esGlobal" class="badge-global">GLOBAL</span>
          </div>
        </ng-template>

      </p-multiSelect>

    </div>

    <!-- BUSQUEDA GLOBAL -->
    <div class="col-md-6">
      <p class="fw-bold mb-1">BÚSQUEDA GLOBAL</p>
      <span class="p-input-icon-left w-100">
        <input type="text" class="form-control" style="height: 45px;" (input)="onBuscarText()"
          [(ngModel)]="textoBusqueda" placeholder="Buscar por título, descripción, folio..." />
      </span>
    </div>

  </div>

  <div class="d-flex justify-content-between align-items-center mt-3">

    <div class="d-flex align-items-center gap-3">

      <!-- LOCAL -->
      <div *ngIf="!mostrarFiltrosGlobales"
        class="px-3 py-2 rounded-3 border bg-light d-flex align-items-center gap-2 shadow-sm">

        <i class="pi pi-building fs-4 text-primary"></i>

        <div class="d-flex flex-column">
          <span class="fw-semibold fs-5">
            {{ sucursalSeleccionadaNombre || 'Sucursal actual' }}
          </span>
        </div>

      </div>

      <!-- GLOBAL -->
      <div *ngIf="mostrarFiltrosGlobales"
        class="px-4 py-2 rounded-3 bg-primary text-white d-flex align-items-center gap-2 shadow">

        <i class="pi pi-globe fs-3"></i>

        <div class="d-flex flex-column">
          <span class="fw-bold text-uppercase" style="font-size: 0.7rem; opacity: 0.85;">
            Modo
          </span>
          <span class="fw-bold fs-5">
            BÚSQUEDA GLOBAL
          </span>
        </div>

      </div>

    </div>


    <!-- ACCIONES -->
    <div class="acciones">
      <p-button label="AGREGAR" icon="pi pi-plus" (click)="mostrarModalNuevaTarea = true">
      </p-button>

      <p-button label="ETIQUETAS" icon="pi pi-tags" severity="danger" (click)="mostrarModalEtiquetas = true">
      </p-button>

      <p-button label="RESPONSABLES" icon="pi pi-users" severity="secondary" (click)="mostrarModalResponsables = true">
      </p-button>

      <p-button label="ARCHIVADOS" icon="pi pi-folder-open" outlined severity="secondary"
        (click)="mostrarModalArchivados = true">
      </p-button>

    </div>

  </div>

</div>

<app-modal-labels-task *ngIf="mostrarModalEtiquetas" [mostrarModal]="mostrarModalEtiquetas"
  (closeEvent)="mostrarModalEtiquetas = false">
</app-modal-labels-task>

<app-modal-task-responsible *ngIf="mostrarModalResponsables" [mostrarModal]="mostrarModalResponsables"
  (closeEvent)="mostrarModalResponsables = false">
</app-modal-task-responsible>

<app-new-task *ngIf="mostrarModalNuevaTarea" [mostrarModal]="mostrarModalNuevaTarea"
  (closeEvent)="mostrarModalNuevaTarea = false">
</app-new-task>

<app-modal-archived-tasks *ngIf="mostrarModalArchivados" [mostrarModal]="mostrarModalArchivados"
  (closeEvent)="mostrarModalArchivados = false"></app-modal-archived-tasks>
