<p-dialog [header]="'CREAR TAREA'" [(visible)]="mostrarModal" [modal]="true" [style]="{ 'width': '95vh' }"
    [maximizable]="true" (onHide)="onHide()">

    <form #form="ngForm" (ngSubmit)="enviar(form)">

        <p class="fw-bold">TÍTULO</p>
        <input class="form-control" style="height: 48px;" type="text" placeholder="ESCRIBE EL TÍTULO DE LA TAREA"
            [(ngModel)]="tarea.titulo" name="titulo"
            [ngClass]="{'p-invalid': formTituloCtrl.invalid && formTituloCtrl.touched}" #formTituloCtrl="ngModel"
            required minlength="3" maxlength="50">
        <small *ngIf="formTituloCtrl.errors?.['required'] && formTituloCtrl.touched" class="p-error">
            Campo requerido.
        </small>
        <small *ngIf="formTituloCtrl.errors?.['minlength'] && formTituloCtrl.touched" class="p-error">
            Mínimo 3 caracteres.
        </small>
        <p></p>

        <p class="fw-bold">RESPONSABLE</p>
        <p-dropdown [options]="sucursales" [(ngModel)]="tarea.idSucursal" name="sucursal" [optionValue]="'id'"
            optionLabel="nombre" [filter]="true" filterBy="nombre" [showClear]="true" #formSucursalCtrl="ngModel"
            placeholder="SELECCIONA SUCURSAL / DEPARTAMENTO" [style]="{width:'100%'}"
            [ngClass]="{'p-invalid': formSucursalCtrl.invalid && formSucursalCtrl.touched}" required="true">
        </p-dropdown>
        <small *ngIf="formSucursalCtrl.invalid && formSucursalCtrl.touched" class="p-error">Campo requerido.</small>
        <p></p>

        <p class="fw-bold">CATEGORÍA</p>
        <p-dropdown [options]="categorias" [(ngModel)]="tarea.idCategoria" name="categoria" [optionValue]="'id'"
            optionLabel="nombre" [filter]="true" filterBy="nombre" [showClear]="true"
            placeholder="SELECCIONA LA CATEGORÍA" [style]="{width:'100%'}" #formCategoriaCtrl="ngModel"
            [ngClass]="{'p-invalid': formCategoriaCtrl.invalid && formCategoriaCtrl.touched}" required="true">
        </p-dropdown>
        <small *ngIf="formCategoriaCtrl.invalid && formCategoriaCtrl.touched" class="p-error">Campo requerido.</small>
        <p></p>

        <p>DESCRIPCIÓN GENERAL</p>
        <textarea [(ngModel)]="tarea.descripcion" name="comentarios" rows="10" class="form-control"
            [ngClass]="{'is-invalid': formComentariosCtrl.invalid && formComentariosCtrl.touched}"
            #formComentariosCtrl="ngModel"></textarea>

        <app-eisenhower-priority-checks [modelo]="tarea" (cambio)="recibirPrioridad($event)">
        </app-eisenhower-priority-checks>

        <br>

        <div>
            <input type="file" id="fileInput" (change)="onFileChange($event)" multiple accept="image/*" hidden />
            <button type="button" (click)="onSeleccionarImagenes()" class="btn-upload">
                Seleccionar imágenes
            </button>

            <div *ngIf="imagenesBase64.length > 0" class="mt-3">
                <h5>Imágenes cargadas (base64):</h5>

                <div class="contenedor-thumbs">
                    <div class="thumb" *ngFor="let img of imagenesBase64; let i = index">
                        <img [src]="img" [alt]="'Imagen ' + (i + 1)" class="thumb-img" />
                        <p class="text-center">Imagen {{ i + 1 }}</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-end mt-3">
            <button class="btn bg-p-b p-3">
                <i class='bx bx-send'></i>
                <label>ENVIAR</label>
            </button>
        </div>

    </form>

</p-dialog>