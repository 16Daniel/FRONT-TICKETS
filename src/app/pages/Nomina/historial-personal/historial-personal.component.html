<div class="p-3 pt-5">
<h5 class="text-center">HISTORIAL</h5>

<div class="row mt-3">
    <div class="col-md-3">
        <p>FECHA INICIO</p>
        <p-calendar 
    [(ngModel)]="fechaini" 
    [iconDisplay]="'input'" 
    [showIcon]="true" 
    inputId="icondisplay"
     dateFormat="dd/mm/yy" 
      [maxDate]="maxDate" 
     [style]="{width:'100%'}" />
    </div>
     <div class="col-md-3">
        <p>FECHA FIN</p>
        <p-calendar 
    [(ngModel)]="fechafin" 
    [iconDisplay]="'input'" 
    [showIcon]="true" 
    inputId="icondisplay" 
    dateFormat="dd/mm/yy"
    [maxDate]="maxDate" 
     [style]="{width:'100%'}"/>
    </div>
    <div class="col-md-5">
        <p>SUCURSALES</p>
          <p-dropdown [options]="sucursales" [(ngModel)]="sucursalSel"
            optionLabel="nombre" [filter]="true" filterBy="nombre" [showClear]="false"
            placeholder="SELECCIONAR SUCURSAL" [style]="{width:'100%'}">
            <ng-template pTemplate="selectedItem" let-selectedOption>
                <div class="flex align-items-center gap-2">
                    <div>{{ selectedOption.nombre }}</div>
                </div>
            </ng-template>
            <ng-template let-dep pTemplate="item">
                <div class="flex align-items-center gap-2">
                    <div>{{ dep.nombre }}</div>
                </div>
            </ng-template>
        </p-dropdown>
    </div>
      <div class="col-md-1">
        <P>&nbsp;</P>
        <button class="btn bg-p-b" style="height: 42px;" (click)="consultar()">CONSULTAR</button>
    </div>
</div>

<div class="d-flex justify-content-center p-3" *ngIf="loading">
     <i class="bx bx-loader bx-lg bx-spin" style="color: rgb(0, 153, 255)"></i>
</div>

<div class="mt-3 d-flex justify-content-center gap-3" *ngIf="data.length>0 && !loading">
    <div class="p-3 rounded-3 shadow" style="background-color: #ffffff; width: 10rem;"> 
        <p  class="text-center fw-bold fs-4"><i class='bx bxs-circle text-success bx-sm'></i>&nbsp;{{porcentajeasistencias | number:'1.0-0'}}%</p>
    </div>
      <div class="p-3 rounded-3 shadow" style="background-color: #ffffff; width: 10rem;">
        <p  class="text-center fw-bold fs-4"><i class='bx bxs-circle text-warning bx-sm'></i>&nbsp;{{porcentajeFR | number:'1.0-0'}}%</p>
    </div>
      <div class="p-3 rounded-3 shadow" style="background-color: #ffffff; width: 10rem;">
        <p  class="text-center fw-bold fs-4"><i class='bx bxs-circle text-danger bx-sm'></i>&nbsp;{{porcentajeFSR | number:'1.0-0'}}%</p>
    </div>
</div>

<div class="mt-3 d-flex justify-content-center p-3" *ngIf="data.length>0 && !loading">
    <div style="height: 500px; width: 100%;">
        <ngx-charts-bar-vertical-normalized
        [scheme]="colorScheme"
        [results]="datag"
        [gradient]="false"
        [xAxis]="true"
        [yAxis]="true"
        [legend]="true"
        [showXAxisLabel]="true"
        [showYAxisLabel]="true"
        [xAxisLabel]="'FECHA'"
        [yAxisLabel]="'PORCENTAJE'"
        legendTitle="INDICADORES"
        >
        </ngx-charts-bar-vertical-normalized>
    </div>
</div>

</div>


@if (data.length>0)
{

    <div class="d-flex flex-wrap gap-3 p-3">
    <div class="d-flex align-items-center">
        <p-radioButton 
            name="opciones" 
            value="1" 
            [(ngModel)]="vista" 
            inputId="ingredient1" />
        <label for="ingredient1" class="ml-2">
            FALTAS
        </label>
    </div>
    
    <div class="d-flex align-items-center">
        <p-radioButton 
            name="opciones" 
            value="2" 
            [(ngModel)]="vista" 
            inputId="ingredient2" />
        <label for="ingredient2" class="ml-2">
            FALTAS RESUELTAS
        </label>
    </div>
    
    <div class="d-flex align-items-center">
        <p-radioButton 
            name="opciones" 
            value="3" 
            [(ngModel)]="vista" 
            inputId="ingredient3" />
        <label for="ingredient3" class="ml-2">
            ASISTENCIAS
        </label>
    </div>
</div>


    <div class="bg-white m-3 shadow" *ngIf="obtenerdataopcion().length>0">   
          @if(vista == 1 || vista == 2) 
          {
                 <p-table [value]="obtenerdataopcion()" [tableStyle]="{ 'min-width': '50rem' }">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>FECHA</th>
                            <th>NOMBRE</th>
                            <th>PUESTO</th>
                            <th>INCIDENCA</th>
                            <th>SOLUCIÃ“N</th>
                            <th>COMENTARIO SUCURSAL</th>
                            <th>ESTATUS</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-item>
                        <tr class="bg-opacity-25 {{obtenerFondo(item)}}">
                            <td class="fw-bold">{{item.fecha}}</td>
                            <td>{{item.nombre}}</td>
                            <td>{{obtenerNombrePuesto(item.idpuesto)}}</td>
                            <td>{{item.incidencia}}</td>
                            <td>
                                <span *ngIf="item.regbitacora != undefined">{{item.regbitacora.solucion}}</span>
                            </td>
                            <td>
                                <span *ngIf="item.regbitacora != undefined">{{item.regbitacora.comentariosucursal}}</span>
                            </td>
                            <td>
                                <i class='bx bx-check-circle bx-sm text-success' *ngIf="item.regbitacora != undefined && item.regbitacora.status"></i>
                                <i class='bx bx-x-circle bx-sm text-danger' *ngIf="item.regbitacora != undefined && !item.regbitacora.status"></i>
                                <i class='bx bx-x-circle bx-sm text-danger' *ngIf="item.regbitacora == undefined"></i>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>

          }
   
            @if(vista == 3) 
          {
                <p-table [value]="obtenerdataopcion()" [tableStyle]="{ 'min-width': '50rem' }">
    <ng-template pTemplate="header">
        <tr>
             <th>FECHA</th>
            <th>NOMBRE</th>
            <th>PUESTO</th>
            <th>ENTRADA REAL</th>
            <th>SALIDA REAL</th>
            <th>INCIDENCA</th>
            <th>ESTATUS</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
            <tr class="bg-opacity-25 bg-success">
                  <td class="fw-bold">{{item.fecha}}</td>
                <td>{{item.nombre}}</td>
                <td>{{obtenerNombrePuesto(item.idpuesto)}}</td>
                <td>{{item.entrada}}</td>
                <td>{{item.salida}}</td>
                <td>{{item.incidencia}}</td>
                <td>
                    <i class='bx bx-check-circle bx-sm text-success'></i>
                </td>
            </tr>
        </ng-template>
    </p-table>


          }


    </div>

}


<p-toast [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}" [showTransformOptions]="'translateY(100%)'"
  [showTransitionOptions]="'500ms'" [hideTransitionOptions]="'500ms'"
  [showTransformOptions]="'translateX(100%)'"></p-toast>