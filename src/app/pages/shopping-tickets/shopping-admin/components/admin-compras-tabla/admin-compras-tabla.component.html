 <p-table [value]="data" [tableStyle]="{'min-width': '60rem', 'padding':'10px'}" [scrollable]="true" scrollHeight="700px"
        styleClass="p-datatable-gridlines" 
        [paginator]="true"
        [rows]="100">
    <ng-template pTemplate="header">
        <tr>
            <th>SOLICITANTE</th>
            <th>SUCURSAL</th>
            <th>FECHA</th>
            <th>REGION</th>
            <th>RAZON SOCIAL</th>
            <th>PROVEEDOR</th>
            <th>MÉTODO PAGO</th>
            <th>ESTATUS</th>
            <th>ESTATUS PAGO</th>
            <th>FECHA DE PAGO</th>
            <th>FECHA ENTREGA</th>
            <th>PALABRA CLAVE</th>
            <th>TOTAL</th>
            @if(autorizado == true)
            {
             <th>FACTURA</th>
             <th>COMPROBANTE PAGO</th>
            }
            <th></th>
            <th></th>
            @if(autorizacion == true){ <th>AUTORIZACIÓN</th>}
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
        <tr class="bg-opacity-25" [ngClass]="{'bg-warning':(item.statuscompra == 0 || item.statuspago == 1), 'bg-success': item.statuspago == 2, 'bg-danger': item.statuscompra == 0}">
            <td>{{item.solicitante}}</td>
            <td>{{obtenerNombreSucursal(item.idSucursalSolicitante)}}</td>
            <td>{{  obtenerFecha(item.fecha) | date}}</td>
            <td>{{ obtenerNombreRegiones(item.regiones) }}</td>
            <td>{{ item.razonsocial }}</td>
            <td>{{ obtenerNombreArea(item.idArea) }}</td>
            <td>{{obtenerNombreMetodoPago(item.metodoPago)}}</td>
            <td>{{ obtenerNombreEstatus(item.statuscompra) }}</td>
            <td>
                <i class='bx bx-x-circle bx-sm text-danger' *ngIf="item.statuspago == 1"></i>
                <i class='bx bx-check-circle bx-sm text-success' *ngIf="item.statuspago == 2"></i>
                </td>
            <td><span *ngIf="item.fechadepago != null">{{obtenerFecha(item.fechadepago) | date }}</span></td>
            <td><span *ngIf="item.fechaEntrega != null"> {{ obtenerFecha(item.fechaEntrega) | date}} </span></td>
            <td>{{ item.palabraclave }}</td>
            <td>${{obtenerTotalCompras(item.articulos)| number:'1.0-2'}}</td>
            @if(autorizado == true)
            {
                <td>
                <div class="d-flex gap-1 justify-content-center">
                    <button class="btn btn-warning" [disabled]="item.metodoPago == '1'" (click)="abrirModalDocumento(item,1)" *ngIf="item.statuspago != 2 && item.statuscompra > 0 || item.factura ==''"><i class='bx bx-cloud-upload bx-sm' ></i></button>&nbsp; 
                  <button class="btn btn-secondary" *ngIf="item.factura != ''" (click)="downloadPdfDirect(item.factura)"><i class='bx bx-file-blank bx-sm'></i></button>
                </div>
            </td> 
            <td>
                <div class="d-flex gap-1 justify-content-center">
                    <button class="btn btn-warning" (click)="abrirModalDocumento(item,2)" *ngIf="item.statuspago == 2 && usuario.id == idAdmin"><i class='bx bx-cloud-upload bx-sm' ></i></button>&nbsp; 
                  <button class="btn btn-secondary" *ngIf="item.comprobantePago != ''" (click)="downloadPdfDirect(item.comprobantePago)"><i class='bx bx-file-blank bx-sm'></i></button>
                </div>
            </td>
            }
            <td><button class="btn btn-primary btn-notification" style="margin: 2px" >
          <i class="bx bx-message-square-dots bx-sm" style="color: rgb(255, 255, 255)" pTooltip="CHAT"  [ngClass]="{'has-notification': verificarChatNoLeido(item)}"
            tooltipPosition="top" (click)="abrirModalChat(item)"></i>
        </button></td>
            <td><button class="btn bg-p-b" pTooltip="DETALLES"  (click)="abrirModalDetalles(item)"><i class='bx bx-show bx-sm' ></i></button></td>
         
        @if(autorizacion == true)
        {
            <td>
             <button class="btn btn-success" (click)="confirmarActualizacion(item,1)"><i class='bx bx-check-circle bx-sm'></i></button>&nbsp;
            <button class="btn btn-danger" (click)="confirmarActualizacion(item,2)"><i class='bx bx-x-circle bx-sm' ></i></button>
        </td>
        }
            
        </tr>
    </ng-template>
</p-table>


<app-subir-documento *ngIf="modalFactura" [visible]="modalFactura" (closeEvent)="modalFactura = false"
 [Reg]="itemReg" [tipoDoc]="tipoDoc"></app-subir-documento>

<app-archivos *ngIf="modalArchivos && itemReg != undefined" [visible]="modalArchivos" 
(closeEvent)="modalArchivos = false" [factura]="itemReg!.factura"></app-archivos>

<app-detalles *ngIf="modalDetalles" [visible]="modalDetalles" [itemReg]="itemReg" [catStatus]="catStatusCompra" [catStatusPago]="catStatusPago"
(closeEvent)="modalDetalles = false" [idAdmin]="idAdmin" [catMetodosPago]="catMetodosPago" [sucursales]="sucursales" [catProveedores]="catProveedores"></app-detalles>

<app-admin-compras-chat *ngIf="modalChat" [showModalChatCompra]="modalChat" [ticket]="itemReg"
  (closeEvent)="modalChat = false"></app-admin-compras-chat>

